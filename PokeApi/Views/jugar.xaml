<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="PokeApi.Views.jugar"
             Title="Jugar"
             xmlns:local="clr-namespace:PokeApi.ViewModels"
             xmlns:animations="clr-namespace:AlohaKit.Animations;assembly=AlohaKit.Animations"
             BackgroundColor="White">

    <ContentPage.BindingContext>
        <local:jugarVM />
    </ContentPage.BindingContext>

    <Grid>

        <!-- Menu inicial -->
        <StackLayout x:Name="MenuInicial" BackgroundColor="White" Padding="30" IsVisible="{Binding MenuReglas}">
            <Label Text="Reglas del juego:"
                   FontSize="24"
                   FontAttributes="Bold"
                   TextColor="Black"
                   HorizontalOptions="Center" />
            <Label Text="• Tienes 20 preguntas.
                   • Cada acierto suma los segundos restantes.
                   • Un fallo resta 1 punto.
                   • No responder no afecta tu puntuación."
                   FontSize="18"
                   TextColor="Black"
                   Margin="0,20,0,20" />
            <Button Text="Empezar"
                    FontSize="20"
                    Command="{Binding EmpezarCommand}"
                    BackgroundColor="Green"
                    TextColor="White"
                    HorizontalOptions="Center" />

            <Button Text="Ver tu puntuacion en el Ranking"
Command="{Binding RankingCommand}"
BackgroundColor="Blue"
TextColor="White"
FontSize="18"
WidthRequest="200"
HorizontalOptions="Center"     />
        </StackLayout>

        <!-- Vista del juego -->
        <VerticalStackLayout x:Name="VistaJuego" Padding="20" Spacing="25" HorizontalOptions="Center" VerticalOptions="Center" IsVisible="{Binding VistaJuego}">
            <Label Text="{Binding PuntuacionTotal}" FontSize="18" TextColor="Black" HorizontalOptions="Start" />
            <Label Text="{Binding RondasTotales , StringFormat='Rondas Totales: {0} /20'}" FontSize="18" TextColor="Black" HorizontalOptions="End" />
            <Label Text="{Binding Contador}" FontSize="48" FontAttributes="Bold" HorizontalOptions="Center" TextColor="DarkRed"/>
            <Image Source="{Binding PreguntaActual.PokemonCorrecto.Foto}" HeightRequest="200" WidthRequest="200" HorizontalOptions="Center" />

            <CollectionView ItemsSource="{Binding PreguntaActual.ListaPokemons}" SelectionMode="Single" SelectedItem="{Binding PokemonSeleccionado, Mode=TwoWay}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <ContentView>
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroupList>
                                    <VisualStateGroup x:Name="CommonStates">
                                        <VisualState x:Name="Normal" />
                                        <VisualState x:Name="Selected">
                                            <VisualState.Setters>
                                                <Setter Property="BackgroundColor" Value="LightSkyBlue" />
                                            </VisualState.Setters>
                                        </VisualState>
                                    </VisualStateGroup>
                                </VisualStateGroupList>
                            </VisualStateManager.VisualStateGroups>

                            <Frame BorderColor="LightGray" CornerRadius="10" Padding="10" Margin="5">
                                <Label Text="{Binding Nombre}" 
                                       FontSize="20" 
                                       HorizontalOptions="Center" 
                                       VerticalOptions="Center" />
                            </Frame>
                        </ContentView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>

        <!-- Mostrar resultado e insertar-->
        <StackLayout x:Name="VistaFinal" Padding="30" IsVisible="{Binding VistaFinal}" VerticalOptions="Center" HorizontalOptions="Center" BackgroundColor="White" Spacing="20">
            <Label Text="¡Has terminado!"
                   FontSize="26"
                   FontAttributes="Bold"
                   TextColor="DarkGreen"
                   HorizontalOptions="Center" />

            <Label Text="{Binding PuntuacionTotal, StringFormat='Puntuación final: {0} puntos'}"
                   FontSize="20"
                   TextColor="Black"
                   HorizontalOptions="Center" />

            <Entry Placeholder="Introduce tu nombre"
                   Text="{Binding Nombre}"
                   FontSize="18"
                   WidthRequest="250"
                   BackgroundColor="#EFEFEF"
                   TextColor="Black" />

            <Button Text="Guardar puntuación"
                    Command="{Binding InsertarCommand}"
                    BackgroundColor="Blue"
                    TextColor="White"
                    FontSize="18"
                    WidthRequest="200"
                    HorizontalOptions="Center" />

            <Label Text="{Binding HaInsertado}"
                    FontSize="20"
                    TextColor="Black"
                    HorizontalOptions="Center" />

            <Button Text="Reiniciar Partida"
                Command="{Binding ReiniciarCommand}"
                BackgroundColor="Blue"
                TextColor="White"
                FontSize="18"
                WidthRequest="200"
                HorizontalOptions="Center" 
                />

            <Button Text="Ver tu puntuacion en el Ranking"
    Command="{Binding RankingCommand}"
    BackgroundColor="Blue"
    TextColor="White"
    FontSize="18"
    WidthRequest="200"
    HorizontalOptions="Center" 
                    IsVisible="{Binding VisibilidadRanking}"
       />
        </StackLayout>
    </Grid>
</ContentPage>
